<div class="main">
<div class="header">
  <div class="title">
    <dx-button icon="fas fa-tasks" type="default"></dx-button>
    <div class="title-name"><span>{{project.name}}</span></div>
  </div>
  <div class="avatars">
    <span class="avatar">
      <img src="https://www.fillmurray.com/50/50" />
    </span>
    <span class="avatar">
      <img src="https://www.fillmurray.com/100/100" />
    </span>
    <span class="avatar">+99 user</span>
  </div>
</div>

<div id="kanban">
  <dx-scroll-view
      class="scrollable-board"
      direction="horizontal"
      showScrollbar="onHover">
      <dx-sortable
          class="sortable-lists"
          itemOrientation="horizontal"
          handle=".list-title"
          (onReorder)="onListReorder($event)">
          <div class="list" *ngFor="let list of lists; let listIndex = index">
              <div class="list-title dx-theme-text-color">
                <span class="dx-icon-square" [style.width]="30" [style.color]="statuses[listIndex]['color']"></span>
                {{statuses[listIndex]['title']}} <span class="badge">{{list.cards.length}}</span>
              </div>
              <dx-button (onClick)="onClickAddNewCard()" class="add-card" icon="add" text="Thêm công việc" *ngIf="listIndex==0">
              </dx-button>
              <dx-scroll-view
                  class="scrollable-list"
                  style="width: fit-content;"
                  direction="vertical"
                  showScrollbar="onHover">
                  <dx-sortable
                      class="sortable-cards"
                      group="cardsGroup"
                      [data]="list.cards"
                      (onDragStart)="onTaskDragStart($event)"
                      (onReorder)="onListReorder($event)"
                      (onAdd)="onTaskDrop($event, statuses[listIndex]['phaseId'])"
                      >
                      <div class="card dx-card dx-theme-text-color dx-theme-background-color" 
                        style=" cursor: unset;"
                        (click)="onCardClick(card)"
                        data-toggle="modal" data-target="#myModal2"
                        *ngFor="let card of list.cards">
                          <div class="card-name">{{card.id}}. {{card.name}}</div>
                          <div class="type">
                            <dx-button
                            (click)="onClickPriority();
                            $event.stopPropagation()"
                            class="priority"
                            text="Trung bình"
                            icon="fas fa-flag"
                            [style.index] = 999999
                            [style.background-color]="'#6495ED'"
                            [style.color]="'white'"
                            >
                            </dx-button>

                            <div class="tags" *ngFor="let item of (card.tags || [])">
                              <i class="fas fa-tag" style="color: '{{item.color}}';"></i>
                            </div>
                          </div>
                          <div class="card-basic-info">
                              <div class="left">
                                <div class="card-assign icon border-dot">
                                  <i class="far fa-user"></i>
                                </div>

                                <div class="card-due-date icon border-dot">
                                  <i class="far fa-calendar-minus"></i>
                                </div>
                                <!-- <div class="expired">Hết hạn</div> -->
                              </div>
                          </div>
                          <!-- Todos  -->
                          <ng-container *ngIf="card.todos.length != 0">
                              <hr>
                              <div class="todo-temp" style="display: flex;">
                                <circle-progress [percent]="90"  [space]="-10" [radius]="5" [outerStrokeWidth]="1"
                                [innerStrokeWidth]="0" [showImage]="true" [outerStrokeColor]="'#4882c2'" [innerStrokeColor]="'#e7e8ea'" [animation]="true"
                                [animationDuration]="50"></circle-progress>
                                <span>{{card.todos[0]}}</span>
                              </div>
                          </ng-container>
                      </div>
                  </dx-sortable>
              </dx-scroll-view>
          </div>
      </dx-sortable>
  </dx-scroll-view>
</div>
<app-modal></app-modal>
</div>


<dx-popup #popup [width]="300" [height]="200" [showTitle]="true" title="Create new card" [dragEnabled]="false"
	[closeOnOutsideClick]="true" [showCloseButton]="false" container=".dx-viewport" [(visible)]="popupVisible">
	<div *dxTemplate="let data of 'content'">
		<p>
			Name Card:
			<dx-text-box [(value)]="cardAdd.name" [placeholder]="'Enter new card name'"></dx-text-box>
		</p><br>
		<div class="button-popup">
			<dx-button [text]="'Create'" [icon]="'check'" [type]="'success'" (onClick)="onClickCreateCard()">
			</dx-button>
			<dx-button [text]="'Close'" (onClick)="onActionPopup()">
			</dx-button>
		</div>
	</div>
</dx-popup>

<dx-load-panel 
  [shading]="true" 
  [(visible)]="isLoading"
  shadingColor="rgba(0,0,0,0.4)"></dx-load-panel>